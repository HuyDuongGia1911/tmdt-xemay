DÆ°á»›i Ä‘Ã¢y lÃ  giáº£i thÃ­ch Ä‘áº§y Ä‘á»§ â€“ rÃµ rÃ ng â€“ theo kiáº¿n trÃºc Laravel vá» táº¡i sao pháº£i chia nhá» thÃ nh Controllers, Requests, Resources, Observers, Policies, Providers, Servicesâ€¦ thay vÃ¬ nhÃ©t háº¿t vÃ o Controller â€” vÃ  chÃºng káº¿t ná»‘i vá»›i nhau nhÆ° tháº¿ nÃ o.

âŒ Náº¿u Ä‘á»ƒ háº¿t trong Controller sáº½ ra sao?

Báº¡n sáº½ gáº·p:

â€¢ File controller dÃ i 5000â€“10000 dÃ²ng
â€¢ KhÃ´ng tÃ¡i sá»­ dá»¥ng Ä‘Æ°á»£c logic
â€¢ KhÃ´ng test Ä‘Æ°á»£c
â€¢ KhÃ´ng báº£o trÃ¬ Ä‘Æ°á»£c
â€¢ KhÃ´ng kiá»ƒm soÃ¡t Ä‘Æ°á»£c quyá»n truy cáº­p
â€¢ KhÃ´ng tÃ¡ch biá»‡t validation â€“ transform â€“ business logic â€“ database events

Laravel Ä‘Æ°á»£c xÃ¢y Ä‘á»ƒ tÃ¡ch tá»«ng nhiá»‡m vá»¥ riÃªng ra â†’ â€œSeparation of concernsâ€.

âœ”ï¸ 1. Controllers â€” Äiá»u phá»‘i luá»“ng request

Nhiá»‡m vá»¥:

Nháº­n request

Gá»i Request Ä‘á»ƒ validate

Gá»i Service Ä‘á»ƒ xá»­ lÃ½ business logic

Gá»i Resource Ä‘á»ƒ format data tráº£ vá»

Return response

Controller khÃ´ng nÃªn chá»©a:

Validation

Business logic

Permission logic

Format JSON

Event logic

CÃ¡ch controller káº¿t ná»‘i vá»›i Request & Resource:

public function store(StoreMotorcycleRequest $request)
{
    $data = $request->validated();

    $motorcycle = $this->service->create($data);

    return new MotorcycleResource($motorcycle);
}


ğŸ“Œ Controller tá»± Ä‘á»™ng dÃ¹ng StoreMotorcycleRequest vÃ¬ Laravel inject qua type-hint.

âœ”ï¸ 2. Form Requests â€” Xá»­ lÃ½ VALIDATION

Thay vÃ¬ viáº¿t validation trong controller:

$request->validate([
   'name' => 'required',
   'price' => 'integer|min:0',
]);


Ta táº¡o file:

app/Http/Requests/StoreMotorcycleRequest.php

Nhiá»‡m vá»¥:

Validate input

XÃ¡c thá»±c quyá»n (authorize)

VÃ­ dá»¥:

public function authorize()
{
    return auth()->user()?->isSeller();
}

public function rules()
{
    return [
        'name' => 'required|string|max:255',
        'price' => 'required|numeric|min:0'
    ];
}


ğŸ’¡ Laravel tá»± Ä‘á»™ng cháº¡y Request khi controller cÃ³ biáº¿n $request dáº¡ng type-hint.

âœ”ï¸ 3. Resources â€” Chuáº©n hÃ³a dá»¯ liá»‡u tráº£ vá» API

Resource giÃºp báº¡n tráº£ vá» JSON sáº¡ch Ä‘áº¹p:

VÃ­ dá»¥:

return new MotorcycleResource($motorcycle);


Trong MotorcycleResource.php:

public function toArray($request)
{
    return [
        'id' => $this->id,
        'name' => $this->name,
        'price' => $this->price,
        'thumbnail_url' => $this->thumbnail_url,
        'seller' => new SellerResource($this->seller),
    ];
}


ğŸ“Œ Náº¿u khÃ´ng dÃ¹ng Resource, JSON tráº£ vá» sáº½ lá»™n xá»™n, rÃ² lá»™ trÆ°á»ng nháº¡y cáº£m.

âœ”ï¸ 4. Observers â€” Theo dÃµi Model Events

DÃ¹ng khi báº¡n muá»‘n:

Tá»± tÃ­nh average_rating khi táº¡o review

Tá»± xÃ³a áº£nh khi xÃ³a xe

Tá»± flush cache khi update xe

VÃ­ dá»¥ trong MotorcycleObserver.php:

public function saved(Motorcycle $motorcycle)
{
    Cache::tags(['motorcycles'])->flush();
}


Laravel tá»± Ä‘á»™ng cháº¡y Observer khi khai bÃ¡o trong AppServiceProvider:

Motorcycle::observe(MotorcycleObserver::class);

âœ”ï¸ 5. Policies â€” Kiá»ƒm soÃ¡t quyá»n truy cáº­p

DÃ¹ng Ä‘á»ƒ xÃ¡c Ä‘á»‹nh:

Ai Ä‘Æ°á»£c sá»­a xe?

Ai Ä‘Æ°á»£c xÃ³a xe?

Ai Ä‘Æ°á»£c viáº¿t review?

VÃ­ dá»¥ MotorcyclePolicy.php:

public function update(User $user, Motorcycle $motorcycle)
{
    return $user->id === $motorcycle->seller->user_id;
}


Controller dÃ¹ng:

$this->authorize('update', $motorcycle);


Náº¿u sai â†’ Laravel tá»± tráº£ vá» 403.

âœ”ï¸ 6. Providers â€” NÆ¡i Ä‘Äƒng kÃ½ Observer, Policy, Binding services

VÃ­ dá»¥ trong AppServiceProvider:

public function boot()
{
    Motorcycle::observe(MotorcycleObserver::class);

    Gate::policy(Motorcycle::class, MotorcyclePolicy::class);
}


Laravel tá»± Ä‘á»™ng kÃ­ch hoáº¡t.

âœ”ï¸ 7. Services â€” Viáº¿t business logic

Controller khÃ´ng nÃªn chá»©a logic lá»›n nhÆ°:

Táº¡o xe + táº¡o tá»“n kho + log hoáº¡t Ä‘á»™ng + gá»­i mail

Xá»­ lÃ½ thanh toÃ¡n

Upload áº£nh

Sync inventory

Táº¡o MotorcycleService.php:

public function create(array $data)
{
    return DB::transaction(function () use ($data) {
        $moto = Motorcycle::create($data);

        Inventory::create(['motorcycle_id' => $moto->id]);

        return $moto;
    });
}


Controller gá»i:

$this->service->create($data);

ğŸ¯ TÃ“M Táº®T: ChÃºng káº¿t ná»‘i vá»›i nhau nhÆ° tháº¿ nÃ o?
ThÃ nh pháº§n	Vai trÃ²	ÄÆ°á»£c gá»i á»Ÿ Ä‘Ã¢u?	Khi nÃ o cháº¡y?
Controller	Äiá»u phá»‘i request	Route â†’ Controller	Má»—i request
Request	Validate + authorize	Inject vÃ o Controller	TrÆ°á»›c hÃ m controller cháº¡y
Service	Business logic	Controller gá»i	Khi controller gá»i
Resource	Chuáº©n hoÃ¡ JSON	Controller return	Khi tráº£ response
Policy	Kiá»ƒm tra quyá»n	$this->authorize()	TrÆ°á»›c khi xá»­ lÃ½
Observer	Láº¯ng nghe Model Events	Laravel tá»± gá»i	Khi model saved/updated/deleted
Provider	ÄÄƒng kÃ½ observers & policies	AppServiceProvider	Khi app boot
ğŸ‰ Báº¡n muá»‘n tÃ´i váº½ sÆ¡ Ä‘á»“ â€œflow request â†’ controller â†’ request â†’ policy â†’ service â†’ observer â†’ resourceâ€?

Hoáº·c muá»‘n tÃ´i Ã¡p dá»¥ng kiáº¿n trÃºc nÃ y cho toÃ n bá»™ module "Motorcycle" cá»§a báº¡n?